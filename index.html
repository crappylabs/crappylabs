<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <title>Facebook Like Standings</title><!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script><!-- Latest compiled and minified CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet"><!-- Optional theme -->
    <!--link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css"-->
    <!-- System CSS -->
    <link href="style.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script>
    var pageAccessToken = {access_token : ''};
    $(document).ready(function() {
          $.ajaxSetup({ cache: true });
            $.getScript('//connect.facebook.net/en_UK/all.js', function(){
            
              FB.init({
                appId      : '922252757809604',
                xfbml      : true,
                version    : 'v2.2',
                status     : true
              });     
              var albumId = '787737351314841';
              FB.getLoginStatus(function(response){                
                pageAccessToken = {access_token : response.authResponse.access_token}
              });            
              // FB.api('/'+albumId+'/photos?fields=data', pageAccessToken, function(response) { //faster
              FB.api('/'+albumId+'/photos', pageAccessToken, function(response) {                
                //set title
                $('#header').append(response.data[0].from.name + ' Standings');                
                
                for(var i=0;i<response.data.length;i++){                  
                  showCandidates(response.data[i].id, pageAccessToken);                  
                }
              });
                                                                             
            });
        var showLikeCounts = function (candidateId, pageAccessToken){             
          FB.api('/'+candidateId+'?fields=id,likes.limit(1).summary(true)', pageAccessToken, _callback);          
        }
        var showCandidates = function (candidateId, pageAccessToken){             
          FB.api('/'+candidateId, pageAccessToken, _callback);                        
        }        
        var counter = 0;
        var profile = '';
        var _callback = function(response){          
          
          if (response.source) {//show candidates                                     
            var link = response.link;
            profile += '<div class="col-xs-6 col-md-4"><div id='+response.id+' class="candidates">';
            profile += '<a href='+link+' target="_blank"><img src='+response.source+' /><\/a>';
            profile += '<\/div><\/div>';
            counter++;
            if(counter % 3 == 0){
              var row = '<div class="row">'+profile+'<\/div>';              
              $('.container-fluid').append(row); 
              
              //clear profile
              profile = '';              
            }
            
            showLikeCounts(response.id, pageAccessToken);
            
          }else{//show likes           
            var totalCount = response.likes.summary.total_count;            
            $('#'+response.id).append('<p>Likes: <b>'+totalCount+'<\/b><\/p>');
          };
                  
        };
      });
    </script>
</head>

<body>
    <h2 id="header"></h2>

    <div class="container-fluid"></div>

    <footer class="wells wells-sm">
        Facebook Like Standings is developed by Bryan CS (<a href="https://twitter.com/yanzite">@yanzite</a>). | Track project development status at <a href="https://github.com/crappylabs/crappylabs.github.io">Github.</a>
    </footer>

    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
</body>
</html>